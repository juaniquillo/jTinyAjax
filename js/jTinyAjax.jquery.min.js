(function($){$.fn.jTinyAjax=function(options){var defaults={url:"",typeRequest:"post",tinymceinit:{theme:"advanced",mode:"exact",theme_advanced_buttons1:"bold,italic,underline,strikethrough,|,justifyleft,justifycenter,justifyright,justifyfull,|,formatselect, removeformat",theme_advanced_buttons2:"",theme_advanced_toolbar_location:"top",theme_advanced_toolbar_align:"left",theme_advanced_statusbar_location:"bottom",theme_advanced_resizing:true},extraParam:'',buttonTextEdit:'save',buttonTextCancel:'cancel',UIfy:false,blockUI:false,blockOptions:{message:'<img src="images/ajax-loader.gif" />',overlayCSS:{backgroundColor:'#eee',opacity:0.5},css:{border:'none',backgroundColor:'transparent'},fadeIn:200,fadeOut:200},ajaxTypeData:'html',onClick:function(){},onCancel:function(){},onSend:function(){},onError:function(){},onSuccess:function(){}},internal={classEdit:"editjTinyAjax",idEdit:"jTinyAjax",idEditConatiner:"jTinyAjaxContain",templateFormEd:'<form action="" class="form_edit_ad"><button class="botons_ui edit_bot_ad" onclick="return false"><span class="ui-button-text"> </span> </button><button class="botons_ui cancelar_bot_ad" onclick="return false"><span class="ui-button-text"> </span></button><input type="hidden", class="editar_hid_imp_ad" value="" /></form>',ini:function(objeto,index){var idActual=objeto.attr('id')||internal.idEdit+'_'+index,idContainer=internal.idEditConatiner+'_'+index,dataEle={'idContainer':idContainer,'idEle':idActual},formEd=$(internal.templateFormEd).hide().find('.editar_hid_imp_ad').attr('value',index+1).end();formEd.find('.edit_bot_ad .ui-button-text').html(options.buttonTextEdit).end().find('.cancelar_bot_ad .ui-button-text').html(options.buttonTextCancel);objeto.addClass(internal.classEdit).attr('id',idActual).wrap('<div id="'+idContainer+'" class="container_editor_ad" />').data(dataEle).parent().append(formEd);if(options.UIfy){internal.uiInit(dataEle.idContainer)}},clickEdit:function(objeto){var idElem=objeto.data('idEle'),idContainer=objeto.data('idContainer');$('#'+idContainer).delegate('.editjTinyAjax','click',function(){var elemnt=$('#'+idElem),content=elemnt.html();$('#'+idElem).data({'html':content});defaults.tinymceinit.elements=idElem;tinyMCE.init(options.tinymceinit);$('#'+idContainer+' .form_edit_ad').show();options.onClick(content);return false})},send:function(objeto){var idElem=objeto.data('idEle'),idContainer=objeto.data('idContainer'),container=$('#'+idContainer);container.delegate('.edit_bot_ad','click',function(){var contentHTML=tinyMCE.get(idElem).getContent(),opcionesAjax={url:options.url,type:options.typeRequest,data:"data="+contentHTML+'&'+options.extraParam,dataType:options.typeData,success:function(content){if(options.ajaxTypeData==="json"){internal.remove(idElem,idContainer,content.data)}else{internal.remove(idElem,idContainer,content)}if(options.blockUI){internal.unblockInt(container)}options.onSuccess(content)},error:function(XMLHttpRequest,textStatus){if(options.blockUI){internal.unblockInt(container)}options.onError(textStatus)}};options.onSend(contentHTML);if(options.blockUI){internal.blockInt(container)}$.ajax(opcionesAjax)})},cancel:function(objeto){var idElem=objeto.data('idEle'),idContainer=objeto.data('idContainer'),content;$('#'+idContainer).delegate('.cancelar_bot_ad','click',function(){content=$('#'+idElem).data('html');internal.remove(idElem,idContainer,content);options.onCancel(content);return false})},remove:function(idElem,idContainer,content){if(content!==''){tinyMCE.get(idElem).setContent(content)}tinyMCE.execCommand('mceRemoveControl',false,idElem);$('.form_edit_ad','#'+idContainer).hide()},blockInt:function(objeto){if($.fn.block){objeto.block(options.blockOptions)}},unblockInt:function(objeto){if($.fn.unblock){objeto.unblock()}},uiInit:function(containerId){if($.fn.button){$('.botons_ui','#'+containerId).button()}}};var $index2=$('div[id^="'+internal.idEdit+'"]').length;return this.each(function(){options=$.extend(defaults,options);var objeto=$(this);internal.ini(objeto,$index2);internal.clickEdit(objeto);internal.cancel(objeto);internal.send(objeto)})}}(jQuery));